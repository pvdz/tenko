# Tenko parser test case

- Path: tests/testcases/export_declaration/fuzzer-case.md

> :: export declaration
>
> ::> fuzzer-case
>
> By fuzzer; input broke printer [diff-ast]

## Input

`````js
// Copyright (C) 2018 Rick Waldron. All rights reserved.
// Copyright (C) 2016 the V8 project authors. All rights reserved.
// This code is governed by the BSD license found in the LICENSE file.
/*---
description: >
    Default AssignmentExpression (which can be recognized as an "anonymous"
    class declaration) is correctly initialized upon evaluation
esid: sec-moduleevaluation
info: |
    [...]
    16. Let result be the result of evaluating module.[[ECMAScriptCode]].
    [...]
    15.2.3.11 Runtime Semantics: Evaluation
    ExportDeclaration : export default AssignmentExpression;
    [...]
    3. If IsAnonymousFunctionDefinition(AssignmentExpression) is true, then
       a. Let hasNameProperty be ? HasOwnProperty(value, "name").
       b. If hasNameProperty is false, perform SetFunctionName(value,
          "default").
    4. Let env be the running execution context's LexicalEnvironment.
    5. Perform ? InitializeBoundName("*default*", value, env).
    [...]
flags: [async, module]
features: [dynamic-import]
---*/
export default (class { valueOf() { return 45; } });
import('./eval-export-dflt-expr-cls-anon.js').then(imported => {
  assert.sameValue(new imported.default().valueOf(), 45, 'binding initialized');
  assert.sameValue(imported.default.name, 'default', 'correct name is assigned');
}).then($DONE, $DONE).catch($DONE);
`````

## Output

_Note: the whole output block is auto-generated. Manual changes will be overwritten!_

Below follow outputs in five parsing modes: sloppy, sloppy+annexb, strict script, module, module+annexb.

Note that the output parts are auto-generated by the test runner to reflect actual result.

### Sloppy mode

Parsed with script goal and as if the code did not start with strict mode header.

`````
throws: Parser error!
  The `export` keyword can only be used with the module goal

start@21:29, error@26:0
╔═══╦══════════════════
 21 ║ undName("*default*", value, env).
 22 ║     [...]
 23 ║ flags: [async, module]
 24 ║ features: [dynamic-import]
 25 ║ ---*/
 26 ║ export default (class { valueOf() { return 45; } });
    ║ ^^^^^^------- error
 27 ║ import('./eval-export-dflt-expr-cls-anon.js').then(im
╚═══╩══════════════════

`````

### Strict mode

Parsed with script goal but as if it was starting with `"use strict"` at the top.

_Output same as sloppy mode._

### Module goal

Parsed with the module goal.

`````
ast: {
  type: 'Program',
  loc:{start:{line:1,column:0},end:{line:30,column:35},source:''},
  body: [
    {
      type: 'ExportDefaultDeclaration',
      loc:{start:{line:26,column:0},end:{line:26,column:52},source:''},
      declaration: {
        type: 'ClassExpression',
        loc:{start:{line:26,column:16},end:{line:26,column:50},source:''},
        id: null,
        superClass: null,
        body: {
          type: 'ClassBody',
          loc:{start:{line:26,column:22},end:{line:26,column:50},source:''},
          body: [
            {
              type: 'MethodDefinition',
              loc:{start:{line:26,column:24},end:{line:26,column:48},source:''},
              key: {
                type: 'Identifier',
                loc:{start:{line:26,column:24},end:{line:26,column:31},source:''},
                name: 'valueOf'
              },
              static: false,
              computed: false,
              kind: 'method',
              value: {
                type: 'FunctionExpression',
                loc:{start:{line:26,column:24},end:{line:26,column:48},source:''},
                generator: false,
                async: false,
                id: null,
                params: [],
                body: {
                  type: 'BlockStatement',
                  loc:{start:{line:26,column:34},end:{line:26,column:48},source:''},
                  body: [
                    {
                      type: 'ReturnStatement',
                      loc:{start:{line:26,column:36},end:{line:26,column:46},source:''},
                      argument: {
                        type: 'Literal',
                        loc:{start:{line:26,column:43},end:{line:26,column:45},source:''},
                        value: 45,
                        raw: '45'
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      type: 'ExpressionStatement',
      loc:{start:{line:27,column:0},end:{line:30,column:35},source:''},
      expression: {
        type: 'CallExpression',
        loc:{start:{line:27,column:0},end:{line:30,column:34},source:''},
        optional: false,
        callee: {
          type: 'MemberExpression',
          loc:{start:{line:27,column:0},end:{line:30,column:27},source:''},
          computed: false,
          optional: false,
          object: {
            type: 'CallExpression',
            loc:{start:{line:27,column:0},end:{line:30,column:21},source:''},
            optional: false,
            callee: {
              type: 'MemberExpression',
              loc:{start:{line:27,column:0},end:{line:30,column:7},source:''},
              computed: false,
              optional: false,
              object: {
                type: 'CallExpression',
                loc:{start:{line:27,column:0},end:{line:30,column:2},source:''},
                optional: false,
                callee: {
                  type: 'MemberExpression',
                  loc:{start:{line:27,column:0},end:{line:27,column:50},source:''},
                  computed: false,
                  optional: false,
                  object: {
                    type: 'CallExpression',
                    loc:{start:{line:27,column:0},end:{line:27,column:45},source:''},
                    optional: false,
                    callee: {
                      type: 'Import',
                      loc:{start:{line:27,column:0},end:{line:27,column:6},source:''}
                    },
                    arguments: [
                      {
                        type: 'Literal',
                        loc:{start:{line:27,column:7},end:{line:27,column:44},source:''},
                        value: './eval-export-dflt-expr-cls-anon.js',
                        raw: "'./eval-export-dflt-expr-cls-anon.js'"
                      }
                    ]
                  },
                  property: {
                    type: 'Identifier',
                    loc:{start:{line:27,column:46},end:{line:27,column:50},source:''},
                    name: 'then'
                  }
                },
                arguments: [
                  {
                    type: 'ArrowFunctionExpression',
                    loc:{start:{line:27,column:51},end:{line:30,column:1},source:''},
                    params: [
                      {
                        type: 'Identifier',
                        loc:{start:{line:27,column:51},end:{line:27,column:59},source:''},
                        name: 'imported'
                      }
                    ],
                    id: null,
                    generator: false,
                    async: false,
                    expression: false,
                    body: {
                      type: 'BlockStatement',
                      loc:{start:{line:27,column:63},end:{line:30,column:1},source:''},
                      body: [
                        {
                          type: 'ExpressionStatement',
                          loc:{start:{line:28,column:2},end:{line:28,column:80},source:''},
                          expression: {
                            type: 'CallExpression',
                            loc:{start:{line:28,column:2},end:{line:28,column:79},source:''},
                            optional: false,
                            callee: {
                              type: 'MemberExpression',
                              loc:{start:{line:28,column:2},end:{line:28,column:18},source:''},
                              computed: false,
                              optional: false,
                              object: {
                                type: 'Identifier',
                                loc:{start:{line:28,column:2},end:{line:28,column:8},source:''},
                                name: 'assert'
                              },
                              property: {
                                type: 'Identifier',
                                loc:{start:{line:28,column:9},end:{line:28,column:18},source:''},
                                name: 'sameValue'
                              }
                            },
                            arguments: [
                              {
                                type: 'CallExpression',
                                loc:{start:{line:28,column:19},end:{line:28,column:51},source:''},
                                optional: false,
                                callee: {
                                  type: 'MemberExpression',
                                  loc:{start:{line:28,column:19},end:{line:28,column:49},source:''},
                                  computed: false,
                                  optional: false,
                                  object: {
                                    type: 'NewExpression',
                                    loc:{start:{line:28,column:19},end:{line:28,column:41},source:''},
                                    arguments: [],
                                    callee: {
                                      type: 'MemberExpression',
                                      loc:{start:{line:28,column:23},end:{line:28,column:39},source:''},
                                      computed: false,
                                      optional: false,
                                      object: {
                                        type: 'Identifier',
                                        loc:{start:{line:28,column:23},end:{line:28,column:31},source:''},
                                        name: 'imported'
                                      },
                                      property: {
                                        type: 'Identifier',
                                        loc:{start:{line:28,column:32},end:{line:28,column:39},source:''},
                                        name: 'default'
                                      }
                                    }
                                  },
                                  property: {
                                    type: 'Identifier',
                                    loc:{start:{line:28,column:42},end:{line:28,column:49},source:''},
                                    name: 'valueOf'
                                  }
                                },
                                arguments: []
                              },
                              {
                                type: 'Literal',
                                loc:{start:{line:28,column:53},end:{line:28,column:55},source:''},
                                value: 45,
                                raw: '45'
                              },
                              {
                                type: 'Literal',
                                loc:{start:{line:28,column:57},end:{line:28,column:78},source:''},
                                value: 'binding initialized',
                                raw: "'binding initialized'"
                              }
                            ]
                          }
                        },
                        {
                          type: 'ExpressionStatement',
                          loc:{start:{line:29,column:2},end:{line:29,column:81},source:''},
                          expression: {
                            type: 'CallExpression',
                            loc:{start:{line:29,column:2},end:{line:29,column:80},source:''},
                            optional: false,
                            callee: {
                              type: 'MemberExpression',
                              loc:{start:{line:29,column:2},end:{line:29,column:18},source:''},
                              computed: false,
                              optional: false,
                              object: {
                                type: 'Identifier',
                                loc:{start:{line:29,column:2},end:{line:29,column:8},source:''},
                                name: 'assert'
                              },
                              property: {
                                type: 'Identifier',
                                loc:{start:{line:29,column:9},end:{line:29,column:18},source:''},
                                name: 'sameValue'
                              }
                            },
                            arguments: [
                              {
                                type: 'MemberExpression',
                                loc:{start:{line:29,column:19},end:{line:29,column:40},source:''},
                                computed: false,
                                optional: false,
                                object: {
                                  type: 'MemberExpression',
                                  loc:{start:{line:29,column:19},end:{line:29,column:35},source:''},
                                  computed: false,
                                  optional: false,
                                  object: {
                                    type: 'Identifier',
                                    loc:{start:{line:29,column:19},end:{line:29,column:27},source:''},
                                    name: 'imported'
                                  },
                                  property: {
                                    type: 'Identifier',
                                    loc:{start:{line:29,column:28},end:{line:29,column:35},source:''},
                                    name: 'default'
                                  }
                                },
                                property: {
                                  type: 'Identifier',
                                  loc:{start:{line:29,column:36},end:{line:29,column:40},source:''},
                                  name: 'name'
                                }
                              },
                              {
                                type: 'Literal',
                                loc:{start:{line:29,column:42},end:{line:29,column:51},source:''},
                                value: 'default',
                                raw: "'default'"
                              },
                              {
                                type: 'Literal',
                                loc:{start:{line:29,column:53},end:{line:29,column:79},source:''},
                                value: 'correct name is assigned',
                                raw: "'correct name is assigned'"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  }
                ]
              },
              property: {
                type: 'Identifier',
                loc:{start:{line:30,column:3},end:{line:30,column:7},source:''},
                name: 'then'
              }
            },
            arguments: [
              {
                type: 'Identifier',
                loc:{start:{line:30,column:8},end:{line:30,column:13},source:''},
                name: '$DONE'
              },
              {
                type: 'Identifier',
                loc:{start:{line:30,column:15},end:{line:30,column:20},source:''},
                name: '$DONE'
              }
            ]
          },
          property: {
            type: 'Identifier',
            loc:{start:{line:30,column:22},end:{line:30,column:27},source:''},
            name: 'catch'
          }
        },
        arguments: [
          {
            type: 'Identifier',
            loc:{start:{line:30,column:28},end:{line:30,column:33},source:''},
            name: '$DONE'
          }
        ]
      }
    }
  ]
}

tokens (77x):
       ID_export ID_default PUNC_PAREN_OPEN ID_class PUNC_CURLY_OPEN
       IDENT PUNC_PAREN_OPEN PUNC_PAREN_CLOSE PUNC_CURLY_OPEN
       ID_return NUMBER_DEC PUNC_SEMI PUNC_CURLY_CLOSE
       PUNC_CURLY_CLOSE PUNC_PAREN_CLOSE PUNC_SEMI ID_import
       PUNC_PAREN_OPEN STRING_SINGLE PUNC_PAREN_CLOSE PUNC_DOT IDENT
       PUNC_PAREN_OPEN IDENT PUNC_EQ_GT PUNC_CURLY_OPEN IDENT PUNC_DOT
       IDENT PUNC_PAREN_OPEN ID_new IDENT PUNC_DOT IDENT
       PUNC_PAREN_OPEN PUNC_PAREN_CLOSE PUNC_DOT IDENT PUNC_PAREN_OPEN
       PUNC_PAREN_CLOSE PUNC_COMMA NUMBER_DEC PUNC_COMMA STRING_SINGLE
       PUNC_PAREN_CLOSE PUNC_SEMI IDENT PUNC_DOT IDENT PUNC_PAREN_OPEN
       IDENT PUNC_DOT IDENT PUNC_DOT IDENT PUNC_COMMA STRING_SINGLE
       PUNC_COMMA STRING_SINGLE PUNC_PAREN_CLOSE PUNC_SEMI
       PUNC_CURLY_CLOSE PUNC_PAREN_CLOSE PUNC_DOT IDENT
       PUNC_PAREN_OPEN IDENT PUNC_COMMA IDENT PUNC_PAREN_CLOSE
       PUNC_DOT IDENT PUNC_PAREN_OPEN IDENT PUNC_PAREN_CLOSE PUNC_SEMI
`````

### Sloppy mode with AnnexB

Parsed with script goal with AnnexB rules enabled and as if the code did not start with strict mode header.

_Output same as sloppy mode._

### Module goal with AnnexB

Parsed with the module goal with AnnexB rules enabled.

_Output same as module mode._

## AST Printer

Printer output different from input [module][annexb:no]:

````js
export default (class{valueOf(){return 45;};});
import('./eval-export-dflt-expr-cls-anon.js').then(imported => {
assert.sameValue((new (imported.default)).valueOf(), 45, 'binding initialized');
assert.sameValue(imported.default.name, 'default', 'correct name is assigned');
}).then($DONE, $DONE).catch($DONE);
````

Produces same AST
